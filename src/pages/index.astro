---
import { Icon } from '@/components/Icon'
import Link from '@/components/Link.astro'
import PageHead from '@/components/PageHead.astro'
import { badgeVariants } from '@/components/ui/badge'
import { buttonVariants } from '@/components/ui/button'
import { SITE } from '@/consts'
import Layout from '@/layouts/Layout.astro'
import { getAllNovels } from '@/lib/content/novels'
import { formatDate } from '@/lib/utils'
import { Image } from 'astro:assets'

const novels = await getAllNovels()
const featuredNovels = novels.slice(0, 3) // Show first 3 novels
---

<Layout containerType="wide">
  <PageHead slot="head" title="Home" />
  <section class="rounded-lg border">
    <div class="flex flex-col space-y-1.5 p-6">
      <h3 class="text-3xl leading-none font-medium">{SITE.title}</h3>
      <p class="text-muted-foreground text-sm">Novel Writing Template</p>
    </div>
    <div class="p-6 pt-0">
      <p class="text-muted-foreground mb-2 text-sm">
        {SITE.description}
      </p>
      <p class="text-muted-foreground mb-2 text-sm">
        Built with <Link
          href="https://astro.build"
          class="text-foreground"
          external
          underline>Astro</Link
        >, <Link
          href="https://tailwindcss.com"
          class="text-foreground"
          external
          underline>Tailwind</Link
        >, and <Link
          href="https://ui.shadcn.com"
          class="text-foreground"
          external
          underline>shadcn/ui</Link
        >, it provides an excellent foundation for creative writers.
      </p>
      <p class="text-muted-foreground text-sm">
        This template supports hierarchical content organization with novels,
        volumes, and chapters, making it perfect for long-form storytelling. The
        reading interface is optimized for distraction-free reading with clean
        typography and intuitive navigation.
      </p>
    </div>
  </section>

  {
    featuredNovels.length > 0 && (
      <section class="flex flex-col gap-y-6">
        <h2 class="text-2xl font-medium">Featured Novels</h2>
        <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
          {featuredNovels.map((novel) => (
            <article class="group bg-card text-card-foreground relative overflow-hidden rounded-lg border shadow-sm transition-all hover:shadow-md">
              <a href={`/novels/${novel.id}`} class="block">
                {novel.data.coverImage ? (
                  <div class="aspect-[3/4] overflow-hidden">
                    <Image
                      src={novel.data.coverImage}
                      alt={novel.data.title}
                      width={300}
                      height={400}
                      class="h-full w-full object-cover transition-transform group-hover:scale-105"
                    />
                  </div>
                ) : (
                  <div class="bg-muted flex aspect-[3/4] items-center justify-center">
                    <Icon
                      name="book-open"
                      className="text-muted-foreground size-12"
                    />
                  </div>
                )}

                <div class="p-4">
                  <h3 class="group-hover:text-primary mb-2 line-clamp-2 text-lg font-semibold">
                    {novel.data.title}
                  </h3>

                  <p class="text-muted-foreground mb-3 line-clamp-3 text-sm">
                    {novel.data.description}
                  </p>

                  <div class="mb-3 flex flex-wrap gap-1">
                    {novel.data.genre?.slice(0, 2).map((genre) => (
                      <span class={badgeVariants({ variant: 'muted' })}>
                        {genre}
                      </span>
                    ))}
                    {novel.data.genre && novel.data.genre.length > 2 && (
                      <span class={badgeVariants({ variant: 'outline' })}>
                        +{novel.data.genre.length - 2}
                      </span>
                    )}
                  </div>

                  <div class="text-muted-foreground flex items-center justify-between text-xs">
                    <div class="flex items-center gap-1">
                      <Icon name="calendar" className="size-3" />
                      {formatDate(novel.data.startDate)}
                    </div>

                    <div class="flex items-center gap-1">
                      <Icon
                        name={
                          novel.data.status === 'completed'
                            ? 'lucide:check-circle'
                            : novel.data.status === 'ongoing'
                              ? 'lucide:play-circle'
                              : novel.data.status === 'hiatus'
                                ? 'lucide:pause-circle'
                                : 'lucide:edit'
                        }
                        className="size-3"
                      />
                      <span class="capitalize">{novel.data.status}</span>
                    </div>
                  </div>

                  {novel.data.wordCount && (
                    <div class="text-muted-foreground mt-2 text-xs">
                      <Icon name="file-text" className="mr-1 inline size-3" />
                      {novel.data.wordCount.toLocaleString()} words
                    </div>
                  )}
                </div>
              </a>
            </article>
          ))}
        </div>
        <div class="flex justify-center">
          <Link
            href="/novels"
            class={buttonVariants({ variant: 'ghost' }) + ' group'}
          >
            See all novels{' '}
            <span class="ml-1.5 transition-transform group-hover:translate-x-1">
              &rarr;
            </span>
          </Link>
        </div>
      </section>
    )
  }

  {
    featuredNovels.length === 0 && (
      <section class="py-12 text-center">
        <Icon
          name="book-open"
          className="text-muted-foreground mx-auto mb-4 size-16"
        />
        <h2 class="mb-2 text-xl font-semibold">
          Welcome to Your Novel Template
        </h2>
        <p class="text-muted-foreground mb-4">
          Start by adding your first novel to the{' '}
          <code class="bg-muted rounded px-1 py-0.5 text-sm">
            src/content/novels/
          </code>{' '}
          directory.
        </p>
        <Link href="/about" class={buttonVariants({ variant: 'outline' })}>
          Learn More
        </Link>
      </section>
    )
  }
</Layout>
